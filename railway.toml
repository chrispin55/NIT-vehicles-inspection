[build]
builder = "NIXPACKS"

[deploy]
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "nit-itvms-web"

[services.variables]
NODE_ENV = "production"
PORT = "3000"

[services.env]
JWT_SECRET = "${JWT_SECRET}"
JWT_EXPIRES_IN = "7d"
FRONTEND_URL = "${PUBLIC_URL}"
RATE_LIMIT_WINDOW_MS = "900000"
RATE_LIMIT_MAX_REQUESTS = "100"

[[services]]
name = "nit-itvms-db"
source = "image"
image = "mysql:8.0"

[services.env]
MYSQL_DATABASE = "nit_itvms"
MYSQL_USER = "nit_user"
MYSQL_PASSWORD = "${MYSQL_PASSWORD}"
MYSQL_ROOT_PASSWORD = "${MYSQL_ROOT_PASSWORD}"

[deploy.healthchecks]
gracePeriod = 30
